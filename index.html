<h2 class="text-4xl font-bold mb-8 italic">菜单</h2>

    <div class="flex gap-4 mb-8">
        <button onclick="filterMenu('小吃')" id="tab-小吃" class="category-tab px-8 py-2 rounded-full font-bold bg-black text-white transition-all">小吃</button>
        <button onclick="filterMenu('干货')" id="tab-干货" class="category-tab px-8 py-2 rounded-full font-bold bg-gray-200 text-gray-600 transition-all">干货</button>
    </div>

    <div id="food-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
        <p class="text-gray-400">正在准备新鲜食材...</p>
    </div>

<script>
    // ... 前面的变量保持不动 ...
    const supabaseClient = supabase.createClient(RAW_URL, RAW_KEY);
    let cart = {};
    let allFoodData = []; // 新增：保存下载的所有数据

    // ... updateUI, updateCartListUI, changeQty, updateFoodControls 保持不动 ...

    // 修改此函数：获取数据并保存到全局变量
    async function fetchMenu() {
        const { data, error } = await supabaseClient.from('foods').select('*');
        if (error) {
            console.error(error);
            return;
        }
        allFoodData = data; // 存下所有数据
        filterMenu('小吃'); // 默认进场显示“小吃”
    }

    // 新增函数：点击切换分类
    function filterMenu(category) {
        // 1. 切换按钮的高亮样式
        document.querySelectorAll('.category-tab').forEach(btn => {
            btn.classList.remove('bg-black', 'text-white');
            btn.classList.add('bg-gray-200', 'text-gray-600');
        });
        document.getElementById(`tab-${category}`).classList.remove('bg-gray-200', 'text-gray-600');
        document.getElementById(`tab-${category}`).classList.add('bg-black', 'text-white');

        // 2. 根据分类过滤数据
        const filteredData = allFoodData.filter(item => item.category === category);
        
        // 3. 渲染过滤后的商品（保持你原本的 HTML 结构完全一致）
        const container = document.getElementById('food-container');
        if (filteredData.length === 0) {
            container.innerHTML = `<p class="text-gray-400 col-span-full py-10">该分类下暂无商品...</p>`;
            return;
        }

        container.innerHTML = filteredData.map(item => `
            <div class="food-card bg-white rounded-[2.5rem] p-2 shadow border">
                <div class="aspect-square rounded-[2rem] overflow-hidden">
                    <img src="${item.image_url}" class="w-full h-full object-cover">
                </div>
                <div class="p-6">
                    <div class="flex justify-between mb-2">
                        <h3 class="font-bold">${item.name}</h3>
                        <span class="text-orange-600 font-black">RM ${item.price}</span>
                    </div>
                    <p class="text-xs text-gray-400 mb-4">${item.description || ''}</p>
                    <div data-food="${item.name}" data-price="${item.price}"></div>
                </div>
            </div>
        `).join('');

        // 4. 必须调用这个来恢复加减号状态
        updateFoodControls();
    }

    // ... 后面的 toggleCartDetail, clearCart, sendOrder 保持不动 ...

    fetchMenu();
</script>
